!function(t,e,a,o){var n,i="threeSixty",r={dragDirection:"horizontal",useKeys:!1,draggable2:!0},s=["horizontal","vertical"],d={},c={},u=[];function h(e,a){n=this,this.element=e,d=d=t.extend({},r,a),this._defaults=r,this._name=i,t.inArray(d.dragDirection,s)<0&&(d.dragDirection=r.dragDirection),this.init()}t.fn.destroy=h.prototype.destroy=function(){!0===d.useKeys&&t(a).unbind("keydown",this.onKeyDown),t(this).removeData(),c.html("")},t.fn.nextFrame=h.prototype.nextFrame=function(){t(this).each(function(e){var a=t(this),o=a.data("lastVal")||0,n=a.data("count");o+=1,a.data("lastVal",o),o>=n?o%=n-1:o<=-n&&(o%=n-1),o>0&&(o=n-o),o=Math.abs(o),a.find(".threesixty-frame").css({opacity:"0"}),a.find(".threesixty-frame:eq("+o+")").css({opacity:"1"})})},t.fn.prevFrame=h.prototype.prevFrame=function(){t(this).each(function(e){var a=t(this),o=a.data("lastVal")||0,n=a.data("count");o-=1,a.data("lastVal",o),o>=n?o%=n-1:o<=-n&&(o%=n-1),o>0&&(o=n-o),o=Math.abs(o),a.find(".threesixty-frame").css({opacity:"0"}),a.find(".threesixty-frame:eq("+o+")").css({opacity:"1"})})},h.prototype.init=function(){var e=t(this.element);c=e,e.each(function(){var e=t(this),a=e.data("path"),o=e.data("count");u.push({path:a,count:o,loaded:0,$el:e}),o}),g(),this.initLoad()},h.prototype.initLoad=function(){var e,a,o=0,n=u.length;for(c.addClass("preloading");o<n;o++)for(a=0;a<u[o].count;a++)e=u[o].path.replace("{index}",a),t("<img/>").data("index",o).attr("src",e).on("load",this.onLoadComplete)},h.prototype.onLoadComplete=function(e){var a=t(e.currentTarget).data("index"),o=u[a];o.loaded++,o.loaded===o.count&&n.onLoadAllComplete(a)},h.prototype.onLoadAllComplete=function(t){var e=u[t].$el,a="",o=u[t].count,n=u[t].path,i=0;for(e.html(""),e.removeClass("preloading");i<o;i++){a+='<image class="threesixty-frame" height="555" width="280" x="13" y="0" style="opacity:'+(0===i?"1":"0")+';" data-index="'+i+'" xlink:href="'+n.replace("{index}",i)+'" tabindex="-1"/>'}e.html(a),this.attachHandlers(t)};var l=0,p=null,f=0,y=0,v=0,m=!1;h.prototype.attachHandlers=function(e){var o=this,n=u[e].$el;if(d.draggable2&&void 0!==a.ontouchstart&&void 0!==a.ontouchmove&&void 0!==a.ontouchend&&void 0!==a.ontouchcancel){var i=n.get()[0];i.addEventListener("touchstart",o.onTouchStart),i.addEventListener("touchmove",o.onTouchMove),i.addEventListener("touchend",o.onTouchEnd),i.addEventListener("touchcancel",o.onTouchEnd)}n.mousedown(function(e){e.preventDefault(),l=t(this).data("count"),p=t(this),e.screenY,v=p.data("lastVal")||0,y=p.data("lastX")||0,f=p.data("lastY")||0,m=!0,p.trigger("down")}),!0===d.useKeys&&t(a).bind("keydown",o.onKeyDown),t(a,"html","body").mouseup(o.onMouseUp),t(a).blur(o.onMouseUp),t("body").mousemove(function(t){o.onMove(t.screenX,t.screenY)})},h.prototype.onTouchStart=function(e){var a=e.touches[0];e.preventDefault(),p=t(e.target).parent(),l=p.data("count"),startX=a.pageX,a.pageY,v=p.data("lastVal")||0,y=p.data("lastX")||0,f=p.data("lastY")||0,m=!0,p.trigger("down")},h.prototype.onTouchMove=function(t){t.preventDefault();var e=t.touches[0];n.onMove(e.pageX,e.pageY)},h.prototype.onTouchEnd=function(t){},h.prototype.onMove=function(t,e){if(m){var a=t,o=e,n=0;if(p.trigger("move"),"vertical"===d.dragDirection)n=o>f?v+1:v-1;else if(a>y)n=v+1;else{if(a===y)return;n=v-1}v=n,f=o,y=a,p.data("lastY",f),p.data("lastX",y),p.data("lastVal",v),n>=l?n%=l-1:n<=-l&&(n%=l-1),n>0&&(n=l-n),n=Math.abs(n),p.find(".threesixty-frame").css({opacity:"0"}),p.find(".threesixty-frame:eq("+n+")").css({opacity:"1"})}},h.prototype.onKeyDown=function(t){switch(t.keyCode){case 37:c.prevFrame();break;case 39:c.nextFrame()}},h.prototype.onMouseUp=function(e){m=!1,t(p).trigger("up")};var g=function(){a.body.onselectstart=function(){return!1}};t.fn[i]=function(e){return this.each(function(){t.data(this,"plugin_"+i)||t.data(this,"plugin_"+i,new h(this,e))})}}(jQuery,window,document);